{% extends "base.html" %}
{% block content %}
  <section>
    <h2>Your forest plan</h2>

    <!-- Show basic context: region + soil -->
    <p class="section-subtitle">
      Region: <strong>{{ region }}</strong> • Soil: <strong>{{ soil }}</strong>
    </p>

    {% if recommendations.plants %}
      <!-- Two-column layout: tree list + impact metrics -->
      <div class="results-grid">
        <!-- List of recommended species + image pill + infographics -->
        <div>
          <h3>Tree species to plant</h3>

          <!-- Image attached pill (shown only when image was uploaded) -->
          {% if has_image %}
          <div class="image-upload-banner image-upload-banner--visible">
            <span class="image-pill-dot"></span>
            <span class="image-pill-text">
              Image from your plot is attached for review.
            </span>
          </div>
          {% endif %}

          <ul class="plant-list">
            {% for p in recommendations.plants %}
              <li>{{ p }}</li>
            {% endfor %}
          </ul>

          <!-- Simple infographic-style bars under the list -->
          <div class="impact-bars">
            <div class="impact-bar">
              <span class="impact-label">Tree density advantage</span>
              <div class="impact-track">
                <div
                  class="impact-fill"
                  style="--fill-ratio: {{ comparison.trees_ratio / 3 }}">
                </div>
              </div>
              <span class="impact-value">{{ comparison.trees_ratio }}× more trees</span>
            </div>

            <div class="impact-bar">
              <span class="impact-label">Time to stability</span>
              <div class="impact-track">
                <div
                  class="impact-fill impact-fill--fast"
                  style="--fill-ratio: {{ 1 / comparison.speed_ratio }}">
                </div>
              </div>
              <span class="impact-value">{{ comparison.speed_ratio }}× faster</span>
            </div>
          </div>
        </div>

        <!-- Calculated stats based on area and tree count -->
        <div class="metrics">
          <h3>Quick stats</h3>

          <!-- Basic plot info -->
          <p>
            Plot area:
            <strong>{{ area_sqm }} m²</strong>
          </p>

          <!-- Two sub-cards: Miyavaki vs Traditional -->
          <div class="metrics-cards">
            <!-- Miyavaki card -->
            <div class="stats-card">
              <h4>Miyavaki forest</h4>
              <p>
                Trees:
                <strong>{{ tree_count }}</strong>
              </p>
              <p>
                Cost per tree:
                <strong>₹{{ recommendations.cost_per_tree }}</strong>
              </p>
              <p>
                Total planting cost:
                <strong>₹{{ impact.total_cost }}</strong>
              </p>
              <p>
                Becomes self-sustaining in about
                <strong>{{ recommendations.maturity_months }} months</strong>
              </p>
              <p>
                CO₂ absorbed per year:
                <strong>{{ impact.co2_kg_per_year }} kg</strong>
              </p>
              <p>
                Oxygen released per year:
                <strong>{{ impact.oxygen_kg_per_year }} kg</strong>
              </p>
            </div>

            <!-- Traditional card -->
            <div class="stats-card stats-card--alt">
              <h4>Traditional plantation</h4>
              <p>
                Trees:
                <strong>{{ traditional_tree_count }}</strong>
              </p>
              <p>
                Cost per tree:
                <strong>₹{{ traditional_cost_per_tree }}</strong>
              </p>
              <p>
                Total planting cost:
                <strong>₹{{ traditional_impact.total_cost }}</strong>
              </p>
              <p>
                Becomes stable in about
                <strong>{{ traditional_maturity_months }} months</strong>
              </p>
              <p>
                CO₂ absorbed per year:
                <strong>{{ traditional_impact.co2_kg_per_year }} kg</strong>
              </p>
              <p>
                Oxygen released per year:
                <strong>{{ traditional_impact.oxygen_kg_per_year }} kg</strong>
              </p>
            </div>
          </div>

          <!-- Short comparison note -->
          <p class="note">
            Miyavaki-style planting gives about
            <strong>{{ comparison.trees_ratio }}× more trees</strong>,
            reaches stability about
            <strong>{{ comparison.speed_ratio }}× faster</strong>,
            for roughly
            <strong>{{ comparison.cost_ratio }}× the cost</strong>
            on the same land (rough demo estimates).
          </p>
        </div>
      </div>

    {% else %}
      <!-- Fallback if no plant data for this combination -->
      <p class="section-subtitle">
        We don’t have data for this combination yet. Try a different region or soil type.
      </p>
    {% endif %}

    <!-- Actions: back + add progress photo -->
    <div class="form-actions">
      <a href="{{ url_for('assess') }}" class="secondary-btn">
        Back to assessment
      </a>

      <a
        href="{{ url_for('progress', region=region, soil=soil, area_sqm=area_sqm) }}"
        class="primary-btn"
      >
        Add progress photo
      </a>
    </div>
  </section>
{% endblock %}
